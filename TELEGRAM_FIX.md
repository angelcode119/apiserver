# ?? Telegram Bots Configuration Fix

## ???? (Problem)

???? ??? ????? ?????? ???? ?? ??????:

```
AttributeError: 'Settings' object has no attribute 'TELEGRAM_BOTS'
```

## ??? (Root Cause)

1. ???? `config.py` ???? `TELEGRAM_BOTS` ?????
2. ????? ????? `telegram_service.py` ??? ?????? ?? `settings.TELEGRAM_BOTS` ??????? ???
3. ????? ?? ?? ?????? multi-bot ??????? ?????? ?? ?? ????? ???? 5 ???? ????? ????

## ?????? ????? (System Architecture)

### ???????? ?????? ?? ?????:

#### 1?? ???? 2FA ????? (Shared 2FA Bot)
- **???:** ????? ?? OTP ???? ????? ????
- **?????:** 1 ??? ???? ??? ????????
- **???????:** ?? `.env` ????
  - `TELEGRAM_2FA_BOT_TOKEN`
  - ?? ????? ?? `telegram_2fa_chat_id` ???? ????

#### 2?? 5 ???? ?????? (Activity Bots) - ???? ?? ?????
- **Bot 1:** ?? Device Notifications (??????? ??????/??????? ?????)
- **Bot 2:** ?? SMS Notifications (??? SMS ??? ????)
- **Bot 3:** ?? Admin Activity Logs (???????? ???????)
- **Bot 4:** ?? Login/Logout Logs (???? ? ????)
- **Bot 5:** ?? Future Use (??????? ????? - ??? build ??)

?? ????? ???? **5 ????** ???? ???????? ??? ????? ????.

## ??????? ????? ??? (Changes Made)

### 1. ???? `app/config.py`
```python
# ????? ??:
TELEGRAM_BOTS: List[Dict[str, Any]] = []

# ?? validator ???? ???? ???? ?? JSON string
@field_validator('TELEGRAM_BOTS', mode='before')
```

**?????:** ??? ???? DEPRECATED ??? ? ??? ???? backward compatibility ??? ????? ???. 
??????? ??????? ???? ?? ??????? ????? ????? (?? ??????? ?? ?????).

### 2. ???? `app/services/telegram_service.py`

????? ??? `_load_bots()`:
- ???? ??????? ?? ???? ???? ??? ???
- ????? ?????? ???? ???? ?? ?? `telegram_multi_service` ??????? ???

### 3. ???? `app/main.py`

???????? ???????? ????? `telegram_service` ?? `telegram_multi_service`:

#### ???:
```python
await telegram_service.notify_settings_changed(...)
await telegram_service.notify_data_deleted(...)
```

#### ???:
```python
await telegram_multi_service.notify_admin_action(...)
```

## ??? ?? ????? (Solution)

### ???? Admin ??????? (Default Administrator):

1. **????? ????:**
```bash
POST /auth/login
{
  "username": "admin",
  "password": "1234567899"
}
```

2. **5 ???? ??????** ?? ?????? (?? @BotFather)

3. **??????? ????? ?? ????? ????:**
```bash
PUT /admin/update/admin
{
  "telegram_2fa_chat_id": "-1001234567890",
  "telegram_bots": [
    {
      "bot_id": 1,
      "bot_name": "admin_devices",
      "token": "BOT1_TOKEN",
      "chat_id": "-1001111111111"
    },
    {
      "bot_id": 2,
      "bot_name": "admin_sms",
      "token": "BOT2_TOKEN",
      "chat_id": "-1002222222222"
    },
    {
      "bot_id": 3,
      "bot_name": "admin_logs",
      "token": "BOT3_TOKEN",
      "chat_id": "-1003333333333"
    },
    {
      "bot_id": 4,
      "bot_name": "admin_auth",
      "token": "BOT4_TOKEN",
      "chat_id": "-1004444444444"
    },
    {
      "bot_id": 5,
      "bot_name": "admin_future",
      "token": "BOT5_TOKEN",
      "chat_id": "-1005555555555"
    }
  ]
}
```

### ???? ???:

? **???? ???? ???? ??? ?????? ?????** (??? ??? ??????? ????? ???? ????)

? **???????? ??? 5 ???? ?? ?? ?? chat_id ????** (??? ??????? ?? ?? ?? ???????)

? **?? ????? ???? ???? 5 ???? ????? ????** (???? ???? ????? ???? ??? ?? ????? ????)

## ??????? ????:

- ?? **??????? ???? ????? ???????:** `BOT_SYSTEM_GUIDE.md`
- ?? **????? ???????? ?????:** `CONFIGURE_ADMIN_BOTS.md`
- ?? **??????? ???? ????:** `QUICK_START.md`

## ????? ???? (Current Status)

? ???? `AttributeError: 'Settings' object has no attribute 'TELEGRAM_BOTS'` ????? ??

? ???? ??????? ???? ??????? ???? ?????? ???

? ????? multi-bot ?? ????? ??? ?????? (?? ??????? ???????)

?? **???? ??????? ?? ????????????? ???? ??????? ?? ????? ????**

## ??? (Testing)

```bash
# ?????? ????
python run.py

# ???? ???? ??? ?????? ??? ? ??? ???? ?? ??????:
# ??  No legacy bots in config (using telegram_multi_service for per-admin bots)
# ? Telegram Multi-Service initialized
```

---

**?????:** 2025-10-31
**????:** 2.0.0
