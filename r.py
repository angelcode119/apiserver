#!/usr/bin/env python3
"""
Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª requirements.txt
ØªÙ…Ø§Ù… Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø±Ùˆ Ø¨Ø§ pip freeze Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡
"""

import subprocess
import sys
from pathlib import Path


def generate_requirements(output_file: str = "requirements.txt"):
    """Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ requirements.txt Ø¨Ø§ pip freeze"""
    
    print("ğŸš€ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡...")
    print("="*60)
    
    try:
        # Ø§Ø¬Ø±Ø§ÛŒ pip freeze
        result = subprocess.run(
            ['pip', 'freeze'],
            capture_output=True,
            text=True,
            check=True
        )
        
        # Ù†ÙˆØ´ØªÙ† Ø¯Ø± ÙØ§ÛŒÙ„
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(result.stdout)
        
        # Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª
        packages = result.stdout.strip().split('\n')
        print(f"\nğŸ“¦ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡:\n")
        for pkg in packages:
            if pkg.strip():
                print(f"   âœ… {pkg}")
        
        print("\n" + "="*60)
        print(f"âœ¨ ÙØ§ÛŒÙ„ {output_file} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!")
        print("="*60)
        print(f"ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§: {len(packages)}")
        print(f"ğŸ“ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„: {Path(output_file).absolute()}")
        print("\nğŸ’¡ Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø§ÛŒÙ† Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§:")
        print(f"   pip install -r {output_file}")
        print("="*60)
        
        return True
        
    except subprocess.CalledProcessError as e:
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ pip freeze: {e}")
        return False
        
    except FileNotFoundError:
        print("âŒ pip Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!")
        print("ğŸ’¡ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Python Ùˆ pip Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.")
        return False
        
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: {e}")
        return False


def main():
    import argparse
    
    parser = argparse.ArgumentParser(
        description='Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ requirements.txt Ø§Ø² Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§:
  python generate_requirements.py
  python generate_requirements.py -o requirements.txt
  python generate_requirements.py --output my_requirements.txt

Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªÙ…Ø§Ù… Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ· ÙØ¹Ù„ÛŒ Python Ø±Ø§
Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² 'pip freeze' Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
        """
    )
    
    parser.add_argument(
        '-o', '--output',
        default='requirements.txt',
        help='Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: requirements.txt)'
    )
    
    args = parser.parse_args()
    
    success = generate_requirements(args.output)
    
    if not success:
        sys.exit(1)


if __name__ == "__main__":
    main()